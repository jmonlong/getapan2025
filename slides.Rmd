---
title: Snarls, pangenome deconstruction, and read mapping with vg giraffe
subtitle: GET-A-PAN
author: Xian Chang & Jean Monlong
date: 06/11/2025
output:
  revealjs::revealjs_presentation:
    theme: white
    transition: none
    highlight: pygments
    background_transition: slide
    center: false
    css: style.css
    incremental: false
    slide_level: 2
    reveal_options:
      progress: true
      slideNumber: true
      controls: true
      hash: true
      navigationMode: linear
---

# Pangenome graph from assemblies

Built by aligning high-quality genomes, saved as paths through the pangenome.

![](imgs/hprc-tubemap.jpeg){.half_wide_img .shadow_img}

Human Pangenome Reference Consortium (HPRC)

<div class="cite">
Liao, Asri, Ebler, et al. Nature 2023
</div>

# Pangenome

![](imgs/pangenome-cartoon-nopaths.svg)

## With haplotype paths

![](imgs/pangenome-cartoon.svg)

# Snarls, intuitively a "bubble"

![](imgs/snarl-intro-1.svg)

# Snarls, formal definition

A snarl is a **subgraph** bounded by two **node sides** that are: 

![](imgs/snarl-intro-2.svg)

# Snarls, formal definition

A snarl is a **subgraph** bounded by two **node sides** that are: 

1. **Separable**: splitting the boundary nodes separates the snarl from the graph

![](imgs/snarl-intro-3.svg)

## Snarls, formal definition

A snarl is a **subgraph** bounded by two **node sides** that are: 

1. **Separable**: splitting the boundary nodes separates the snarl from the graph
2. **Minimal**: no nodes within the snarl are separable with either boundary node side 

![](imgs/snarl-intro-4.svg)

## Snarls, formal definition

A snarl is a **subgraph** bounded by two **node sides** that are: 

1. **Separable**: splitting the boundary nodes separates the snarl from the graph
2. **Minimal**: no nodes within the snarl are separable with either boundary node side 

![](imgs/snarl-intro-3.svg)

# Chains

A run of consecutive snarls and nodes is called a **chain**.

![](imgs/snarl-intro-chain.svg)

## Snarl decomposition

Snarls and chains can be **nested** inside of each other.

![](imgs/snarl-intro-nested.svg)

## Snarl decomposition 

The nested relationship of snarls and chains is described by the **snarl tree**.

![](imgs/snarl-intro-tree.svg)

## Netgraphs

Netgraphs are a representation of snarls with their **child chains collapsed** into a single node

![](imgs/snarl-intro-netgraph.svg)


# Snarl examples (`vg deconstruct`)

vcf + graph + decomposition for this graph 

![](imgs/snarl2.jpg)

## Snarl examples (`vg deconstruct`)

vcf + graph + decomposition for this graph 

![](imgs/badgraph2.jpg)

## Snarl examples (`vg deconstruct`)

vcf + graph + decomposition for this graph 

![](imgs/badgraph1.png)

## Snarl examples (`vg deconstruct`)

Trick for getting this snarl decomposition to look better (currently only for the distance index):

`vg index -j [graph.dist] -w 6`


vcf + graph + decomposition for this graph 

![](imgs/badgraph1.png)


# Mapping reads with `vg giraffe`


<!-- Make two columns like in https://bookdown.org/yihui/rmarkdown-cookbook/multi-column.html -->


:::: {style="display: flex;"}

::: {}
Short reads

![](imgs/sr-giraffe-paper.png)
:::

::: {}
Long reads

![](imgs/lr-giraffe-paper.png)
:::

::::

# Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}


:::

::: {}


![](imgs/mapping-overview1.svg)

:::

::::

## Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}

1. Seeding

:::

::: {}


![](imgs/mapping-overview2.svg)

:::

::::

## Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining

:::

::: {}


![](imgs/mapping-overview3.svg)

:::

::::

## Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining

:::

::: {}


![](imgs/mapping-overview4.svg)

:::

::::

## Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/mapping-overview5.svg)

:::

::::


## Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/mapping-overview6.svg)

:::

::::



## Read mapping algorithm overview

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/mapping-overview7.svg)

:::

::::

## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/mapping-overview8.svg)

:::

::::

## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. **Seeding** with **Minimizer Index**
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/sr-giraffe1.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. **Clustering** with **Distance Index**
1. Alignment

:::

::: {}


![](imgs/sr-giraffe2.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. **Clustering** with **Distance Index**
1. Alignment

:::

::: {}


![](imgs/sr-giraffe3.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. **Alignment**

:::

::: {}


![](imgs/sr-giraffe4.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. **Gapless extension**

:::

::: {}


![](imgs/sr-giraffe5.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. **Gapless extension** with **GBWT**

:::

::: {}


![](imgs/sr-giraffe6.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. **Gapless extension** with **GBWT**

:::

::: {}


![](imgs/sr-giraffe7.svg)

:::

::::


## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. Gapless extension
1. **Gapped alignment** with graph

:::

::: {}


![](imgs/sr-giraffe8.svg)

:::

::::



## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. Gapless extension
1. **Gapped alignment** with graph

:::

::: {}


![](imgs/sr-giraffe9.svg)

:::

::::

## Short read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering
1. Gapless extension
1. Gapped alignment

:::

::: {}


![](imgs/sr-giraffe10.svg)

:::

::::


# Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/lr-giraffe1.svg)

:::

::::




# Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. **Seeding** with **Minimizer Index**
1. Clustering/chaining
1. Alignment

:::

::: {}


![](imgs/lr-giraffe-seeding.svg)

:::

::::


# Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-chaining1.svg)

:::

::::


## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-linear-chaining1.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-linear-chaining2.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-linear-chaining3.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-linear-chaining4.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-chaining1.svg)

:::

::::


## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-chaining2.svg)

:::

::::




## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Chaining**
1. Alignment


:::

::: {}

![](imgs/lr-giraffe-chaining3.svg)

:::

::::



# Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment

:::

::: {}


![](imgs/giraffe-zips1.svg)

:::

::::


## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips2.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips3.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips4.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips5.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips6.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips7.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips8.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips9.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. **Zip code tree making** with **Distance Index**
1. Chaining with **Zip code trees**
1. Alignment


:::

::: {}


![](imgs/giraffe-zips10.svg)

:::

::::


## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. Zip code tree making
1. Chaining
1. **Alignment** with graph

:::

::: {}


![](imgs/lr-giraffe-chaining2.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. Zip code tree making
1. Chaining
1. **Alignment** with graph

:::

::: {}


![](imgs/lr-giraffe-alignment1.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. Zip code tree making
1. Chaining
1. **Alignment** with graph

:::

::: {}


![](imgs/lr-giraffe-alignment2.svg)

:::

::::



## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. Zip code tree making
1. Chaining
1. **Alignment** with graph

:::

::: {}


![](imgs/lr-giraffe-alignment3.svg)

:::

::::

## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. Zip code tree making
1. Chaining
1. **Alignment** with graph

:::

::: {}


![](imgs/lr-giraffe-alignment4.svg)

:::

::::


## Long read giraffe algorithm

:::: {style="display: flex;"}

::: {}

1. Seeding 
1. Zip code tree making
1. Chaining
1. Alignment

:::

::: {}


![](imgs/lr-giraffe-final-alignment.svg)

:::

::::


# Giraffe results

On the HPRC v2 graph which is x size?

![](imgs/giraffe-memory-runtime.png){.half_wide_img}

# `vg` graph formats and indexes

**Indexes** 

::: incremental

1. `.gbwt` (Graph Burrows Wheeler Transform): haplotype paths
1. `.gg` (GBWT Graph): node sequences for a GBWT
1. `.dist` (Distance Index): snarl decomposition plus minimum distances
1. `.zipcodes`: per-node distance information used by `vg giraffe`
1. `.min` (Minimizer Index): minimizers used by `vg giraffe`
1. `.gcsa` (Generalized Compressed Suffix Array): substring index used by `vg map` and `vg mpmap`

:::

**Graphs** 

::: incremental

1. `.gbz` (GBWT + GG): the graph induced by the GBWT
1. `.hg` (/`.vg`) (HashGraph): graph format optimized for speed
1. `.pg` (/`.vg`) (PackedGraph): graph format optimized for space efficiency
1. `.xg`: older graph format
1. `.vg`: protobuf-based graph format 

:::

# Conclusion

# Useful resources

- vg wiki 
  - file types: https://github.com/vgteam/vg/wiki/File-Types
  -  snarl explainer: https://github.com/vgteam/vg/wiki/Snarls-and-chains
  - deconstruct: https://github.com/vgteam/vg/wiki/VCF-export-with-vg-deconstruct

- vg manpage: https://github.com/vgteam/vg/wiki/vg-manpage

- snarls paper doi: 10.1089/cmb.2017.0251

- short read giraffe paper doi: 10.1126/science.abg8871

- long read giraffe paper doi: 10.1101/2025.09.29.678807 


